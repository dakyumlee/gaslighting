<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>가스라이팅 실험실</title>
  <style>
    @font-face {
      font-family: 'ChosunGu';
      src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_20-04@1.0/ChosunGu.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }

    body {
      font-family: 'ChosunGu', sans-serif;
      background-color: #fff7f0;
      color: #333;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 30px;
    }

    .container {
      display: grid;
      gap: 20px;
      max-width: 600px;
      margin: auto;
    }

    select {
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #ccc;
      font-family: 'ChosunGu';
      font-size: 1rem;
      background-color: #fff;
    }

    button {
      padding: 14px;
      border: none;
      border-radius: 12px;
      background-color: #ff8989;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      font-family: 'ChosunGu';
    }

    button:hover {
      background-color: #e26b6b;
    }

    #result {
      margin-top: 30px;
      background: #fff3f3;
      border-radius: 12px;
      padding: 20px;
      font-size: 1.1rem;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <h1>🧪 가스라이팅 실험실 🧪</h1>
  <div class="container">
    <select id="situation">
      <option value="">상황을 선택하세요</option>
    </select>

    <select id="statement">
      <option value="">상대방의 말을 선택하세요</option>
    </select>

    <select id="dialogue">
      <option value="">당신의 반응을 선택하세요</option>
    </select>

    <button onclick="generateGaslighting()">가스라이팅 생성하기</button>

    <div id="result"></div>
  </div>

  <script>
    async function fetchOptions(endpoint, selectId) {
      const res = await fetch(endpoint)
      const data = await res.json()
      const select = document.getElementById(selectId)
      data.forEach(item => {
        const option = document.createElement('option')
        option.value = item.id
        option.text = item.name
        select.appendChild(option)
      })
    }

    async function generateGaslighting() {
      const situation = document.getElementById('situation').selectedOptions[0]?.text
      const statement = document.getElementById('statement').selectedOptions[0]?.text
      const dialogue = document.getElementById('dialogue').selectedOptions[0]?.text

      const resultDiv = document.getElementById('result')
      resultDiv.innerText = `"${situation}" 상황에서\n상대방은 "${statement}"라고 말했고\n너는 "${dialogue}"라고 반응했어\n\n그래서 지금 이렇게 된 거야... 피이~`;
    }

    fetchOptions('/api/situations', 'situation')
    fetchOptions('/api/statements', 'statement')
    fetchOptions('/api/dialogues', 'dialogue')

    fetch('http://localhost:9090/api/dialogue/generate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          text: '왜 연락 안 해?'
        })
      })
        .then(res => res.json())
        .then(data => {
          console.log(data.aiReply)
        })

        const handleFight = async () => {
            if (!situation) return
            const res = await fetch('/api/dialogue/generate', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ text: situation })
            })
            const data = await res.json()
            setLog([...log, { user: situation, ai: data.aiReply }])
            setSituation('')
          }
          
      
  </script>
</body>
</html>
