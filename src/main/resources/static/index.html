<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>가스라이팅 실험실</title>
  <style>
    @font-face {
      font-family: 'ChosunGu';
      src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_20-04@1.0/ChosunGu.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }

    body {
      font-family: 'ChosunGu', sans-serif;
      background: #fdfdfd;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: start;
      min-height: 100vh;
    }

    header {
      margin-top: 40px;
      font-size: 36px;
      color: #222;
    }

    .container {
      margin-top: 40px;
      background: #fff;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 600px;
    }

    .section {
      margin-bottom: 20px;
    }

    select, button {
      font-family: 'ChosunGu';
      font-size: 16px;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ddd;
      width: 100%;
      margin-top: 10px;
    }

    button {
      background-color: #ffdee0;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #ffc9cc;
    }

    .result {
      margin-top: 20px;
      padding: 20px;
      background: #fff0f3;
      border-radius: 10px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <header>가스라이팅 실험실</header>
  <div class="container">
    <div class="section">
      <label for="situation">상황 선택</label>
      <select id="situation"></select>
    </div>
    <div class="section">
      <label for="statement">가스라이팅 문장</label>
      <select id="statement"></select>
    </div>
    <div class="section">
      <label for="dialogue">대화 선택</label>
      <select id="dialogue"></select>
    </div>
    <button onclick="generateResult()">실험 시작</button>
    <div class="result" id="result">여기에 결과가 표시됩니다</div>
  </div>

  <script>

    async function fetchOptions(endpoint, target) {
      const res = await fetch(`/api/${endpoint}`);
      const data = await res.json();
      const select = document.getElementById(target);
      select.innerHTML = data.map(d => `<option value="${d}">${d}</option>`).join('');
    }

    async function generateResult() {
      const sit = document.getElementById('situation').value;
      const stmt = document.getElementById('statement').value;
      const dlg = document.getElementById('dialogue').value;
      document.getElementById('result').textContent = `${sit} → ${stmt} → ${dlg}`;
    }

    fetchOptions('situations', 'situation');
    fetchOptions('statements', 'statement');
    fetchOptions('dialogues', 'dialogue');
    fetch('/api/situations')
  .then(res => res.json())
  .then(data => console.log(data));

  async function generateResult() {
    const [statementRes, dialogueRes] = await Promise.all([
      fetch('/api/statements'),
      fetch('/api/dialogues')
    ])
    const statements = await statementRes.json()
    const dialogues = await dialogueRes.json()
  
    const statement = statements[Math.floor(Math.random() * statements.length)]
    const dialogue = dialogues[Math.floor(Math.random() * dialogues.length)]
  
    const resultDiv = document.getElementById('result')
    resultDiv.innerText = `${statement.content} 그리고 ${dialogue.content} (전생은 끝) ㅋㅋㅅㅂ`
  }

  document.getElementById('situation').addEventListener('change', async (e) => {
    const situationId = e.target.value
    const res = await fetch(`/api/statements?situationId=${situationId}`)
    const data = await res.json()
  
    const select = document.getElementById('statement')
    select.innerHTML = data.map(d => `<option value="${d.id}">${d.content}</option>`).join('')
  })
  
  </script>
</body>
</html>
